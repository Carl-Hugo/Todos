name: .NET Core

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v1
      - uses: actions/setup-dotnet@v1
        with:
          dotnet-version: 3.1.100

      - name: Install newman
        run: npm install -g newman

      - name: Current directory
        run: echo $PWD
      - name: Collection content
        run: cat .github/workflows/postman_collection.json

      - name: Run and test
        run: (trap 'kill 0' SIGINT; (sleep 10 && echo 'Starting Newman!' && newman run ./.github/workflows/postman_collection.json --insecure; kill 0 %) & (ASPNETCORE_URLS="https://*:5001" dotnet run --project TodoBasic/Todos.csproj))
      # - name: Run
      #   run: dotnet build TodoBasic/Todos.csproj #dotnet run --project TodoBasic/Todos.csproj
      # - name: Test
      #   uses: matt-ball/newman-action@master
      #   with:
      #     collection: .github/workflows/postman_collection.json
      #     insecure: true
